<link rel="stylesheet" href="css/user_manage.css"/>
<script src="lib/jquery.min.js"  async="async"> </script>
<script src="lib/jquery.jqgrid.min.js"></script>
<script src="lib/grid.locale-de.min.js"></script>
<link rel="stylesheet" href="css/ui.jqgrid.css"/>
<link rel="stylesheet" href="css/jquery-ui.min.css"/>
<link rel="stylesheet" href="css/theme.css"/>
<div class="credit_case_in" ng-controller="credit_case_in">
    <div class="div1">
        <div style="overflow: hidden">
            <form action="" method="post" id="case_query1">
                <ul style="margin-top: 15px;margin-left: 10px;margin-bottom: 5px">
                    <li>
                        <label for="batch_number1">用户名字：</label>
                        <input id="batch_number1" class="form-field" type="text"/>
                    </li>
                    <li style="margin-left: 40px">
                        <input class="submit-button" type="button" value="查询" style="height:39px;display: inline-block;width: 108px"/>
                    </li>
                </ul>
            </form>
        </div>
        <div style="margin-top: 15px;">
            <ul style="list-style: none;overflow: hidden;height: 40px">
                <li style="float: left;margin-left: 32px;">
                    <span id="add" class="submit-button" style="display: inline-block;width: 70px;text-align: center">新增</span>
                </li>
                <li style="float: left;margin-left: 32px;">
                    <span id="edit" class="submit-button" style="display: inline-block;width: 70px;text-align: center">编辑</span>
                </li>
                <li style="float: left;margin-left: 32px;">
                    <span id="del" class="submit-button" style="display: inline-block;width: 70px;text-align: center">删除</span>
                </li>
            </ul>
        </div>
    </div>
    <div style="width: 97%;margin: 0 auto;border: #F2F2F2 solid 5px;border-radius: 10px"></div>
    <div class="div2">
        <table id="list1"></table>
        <div id="pager"></div>
        <!--<div id="pager"></div>-->
    </div>
    <div id="goodcover"></div>
    <div id="code">
        <div style="overflow: hidden;border-bottom: #F6D4BC solid 2px;border-radius: 0 0 5px 5px; background-color: #F6D4BC;">
            <a  id="closebt" href="javascript:void(0)" style="font-size: 20px;color: #CC2900;float: right;display:inline-block">
                <i class="fa fa-times-circle"></i>
            </a>
        </div>
        <div class="box_content">
            <ul>
                <form action="" id="add_form">
                    <li style="height: 230px;margin: 20px; border: dotted 2px #D7D7D7;border-radius: 5px;overflow: hidden">
                        <ul style="margin-left: 18px">
                            <li style="margin-top: 20px">
                                <label for="login">登录账号：</label>
                                <input id="login" class="form-field" type="text" style="margin-right: 15px"/>
                                <label for="pas">登录密码：</label>
                                <input id="pas" class="form-field" type="text"/>
                            </li>
                            <li style="margin-top: 10px">
                                <label for="user_name">用户名字：</label>
                                <input id="user_name" class="form-field" type="text" style="margin-right: 15px"/>
                                <label for="sex" style="margin-left: 10px">性别：</label>
                                <input id="sex" class="form-field" type="text" style="margin-left: 20px"/>
                            </li>
                            <li style="margin-top: 10px">
                                <label for="tel" style="margin-left: 10px">电话：</label>
                                <input id="tel" class="form-field" type="text"
                                       style="margin-right: 15px;margin-left: 20px"/>
                                <label for="eml" style="margin-left: 10px">邮箱：</label>
                                <input id="eml" class="form-field" type="text" style="margin-left: 20px"/>
                            </li>
                            <li style="margin-top: 10px">
                                <label for="status" style="margin-left: 10px">状态：</label>
                                <input id="status" class="form-field" type="text"
                                       style="margin-right: 15px;margin-left: 20px"/>
                            </li>
                        </ul>
                    </li>
                    <li id="drop_down2" style="height: 75px;margin: 20px; border: dotted 2px #D7D7D7;border-radius: 5px;">
                        <ul style="overflow: hidden">
                            <li style="float: left;display: inline-block;margin-top:25px;margin-left: 10px">
                                <label for="region_excutive">地区主管：</label>
                            </li>
                            <li class="dropdown" style="float: left;margin: 20px 15px 0px 5px">

                                <select class="dropdown-select" name="region_excutive" id="region_excutive">
                                    <option value="0">请选择</option>
                                    <option value="beijing">北京地区主管</option>
                                    <option value="chengdu">成都地区主管</option>
                                    <option value="shanghai">上海地区主管</option>
                                    <option value="chongqing">重庆地区主管</option></select>
                                </select>
                            </li>
                            <li style="float:left;display: inline-block;margin-top:25px;margin-left:10px">
                                <label for="region_excutive">催收组长：</label>
                            </li>
                            <li class="dropdown" style="float: left;margin: 20px 15px 15px 5px">

                                <select class="dropdown-select" name="region_excutive" id="region_excutive">
                                    <option value="0">请选择</option>
                                    <option value="A">催收组长A</option>
                                    <option value="B">催收组长B</option>
                                    <option value="C">催收组长C</option>
                                    <option value="D">催收组长D</option></select>
                                </select>
                            </li>
                        </ul>
                    </li>
                    <li id="assign" class="confirm_assign" style="margin-left: 200px"><span style="line-height: 35px">添加</span></li>
                </form>
            </ul>
        </div>

    </div>
</div>
<script type="text/javascript">
    $(document).ready(function (){
        jQuery("#list1").jqGrid({
            url:"system_manage.php?action=request_manage_user",
//            url:"server.php?action=request_case_close",
//            datatype: "local",
            datatype: "json",
            colNames:['登录账号','登录密码','用户名字','性别','电话', '邮箱','状态'],
            colModel:[
                {name:'登录账号',index:'A', width:120,align:'center'},
                {name:'登录密码',index:'B', width:60},
                {name:'用户名字',index:'C', width:120},
                {name:'性别',index:'D', width:120},
                {name:'电话',index:'E', width:120,align:'center'},
                {name:'邮箱',index:'F', width:120,align:'center'},
                {name:'状态',index:'G', width:120, sortable:false, align:'center'},
            ],
            rowNum : 15,
            sortname : 'id',
            gridview:true,
//            pager: '#pager',
            viewrecords: true,
            sortable:true,
            sortorder: "asc",
            emptyrecords: "Nothing to display",
            editurl : "system_manage.php?action=manage_user_edit",
            scrollrows:true,
            autowidth:true,
            rownumbers:true,
            height:450,
            hoverrows:true,
            shrinkToFit:false,
            autoScroll: false,
            mtype : "post",
            repeatitems: false,
            loadtext:"loading...",
//            loadui:"block",
            scroll:true,
            loadComplete:function(data){
                if(data.records==0){
                }else{

                }
            }
        });
        jQuery.fn.center = function() {
            var obj = this;
            body_width = parseInt(obj.parent().width());
            body_height = parseInt(obj.parent().height());
            block_width = parseInt(obj.width());
            block_height = parseInt(obj.height());

            left_position = parseInt((body_width / 2) - (block_width / 2) + $(window).scrollLeft());
            if (body_width < block_width)
            {
                left_position = 0 + $(window).scrollLeft();
            }

            top_position = parseInt((body_height / 2) - (block_height / 2) + $(window).scrollTop());
            if (body_height < block_height)
            {
                top_position = 0 + $(window).scrollTop();
            }
            obj.css({
                'position': 'absolute'
            });
            obj.css({
                'top': (obj.parent().height() - $('#code').height()) * 0.5,
                'left': left_position
            });
            $(window).bind('resize', function() {
                obj.center();
            });
            $(window).bind('scroll', function() {
                obj.center();
            });
        };
        $("#case_close").click(function(){
            var sels = $("#list1").jqGrid('getGridParam','selarrrow');
            console.info("sels",sels);
            if(sels=="")
            {
                alert("请选择要关闭的项！");
            }
            else
            {
                if(confirm("确认要关闭选择案件？"))
                {
                    $.ajax({
                        url:"system_manage.php?action=case_close",
                        type:"POST",
                        dataType:"json",
                        data:{
                           sels:sels
                        },
                        success:function(data,textStatus,jqXHR){
                    if(data.msg == "success")
                        {
                         alert("关闭成功！");
                            var len = sels.length;
                            for(var i= 0;i<len;i++)
                            {
                                $("#list1").jqGrid('delRowData',sels[0]);
                            }
                        }
                        else
                        {
                        alert("关闭失败！");
                        }
                        }
                    });
                }
            }
        });
        $('#add').click(function() {

                $('#code').center();
                $('#goodcover').show();
                $('#code').fadeIn();
                localStorage.setItem("sels",sels);
        });
        $('#closebt').click(function() {
            $('#code').fadeOut();
            $('#goodcover').hide();
        });
        $('#assign').click(function(){
            var hand_zone_excute = "";
            var hand_leader = "";
            if(confirm("确认要添加？"))
            {
                $.ajax({
                    url:"system_manage.php?action=manage_user_add",
                    type:"POST",
                    dataType:"json",
                    data:{
                        login:$("#login").val(),
                        pas:$("#pas").val(),
                        user_name:$("#user_name").val(),
                        sex:$("#sex").val(),
                        tel:$("#tel").val(),
                        eml:$("#eml").val(),
                        status:$("#status").val(),
                        hand_zone_excute:$("#drop_down2").find("select").eq(0).val(),
                        hand_leader:$("#drop_down2").find("select").eq(1).val()
                    },
                    success:function(data,textStatus,jqXHR){
                        if(data.msg == "success")
                        {
                            alert("添加成功！");
                            $('#code').fadeOut();
                            $('#goodcover').hide();
                            $("#list1").jqGrid('setGridParam',{
                                url:"system_manage.php?action=request_manage_user"
                            }).trigger("reloadGrid");
                        }
                        if(data.msg == "error")
                        {
                            alert("添加失败！");
                        }
                    }
                });
                localStorage.removeItem("hand_zone_excute");
                localStorage.removeItem("hand_leader");
                localStorage.removeItem("sels");
            }

        });
        $("#del").click(function(){
            var sels = $("#list1").jqGrid('getGridParam','selrow');
            console.info("sels",sels);
            if(sels==null)
            {
                alert("请选择要删除的项！");
            }
            else
            {
                if(confirm("您是否确认删除？"))
                {
                    $.ajax({
                        url: "system_manage.php?action=del_row",
                        data: {sels: sels},
                        type: 'POST',
                        dataType: 'json',
                        success: function (data, textStatus) {
                            alert("删除成功！");
                                $("#list1").jqGrid("delRowData", sels);
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("删除失败！");
                        }
                    });
                }
            }
        });
        $("#edit").click(function(){
            var sels = $("#list1").jqGrid('getGridParam','selrow');
            console.info("sels",sels);
            if(sels==null)
            {
                alert("请选择要编辑的项！");
            }
            else
            {
                $("#list1").jqGrid('editRow', sels);
            }
        });
    });
</script>